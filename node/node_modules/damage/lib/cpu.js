var os = require('os');

function processUsage () {}

var getUsage = function (pid,cb) { cb&&cb(null,0); };

if (os.platform().indexOf('win')!==-1)
{
	var usage = require(__dirname+'/../build/Release/damage.node');

	getUsage = function (pid,cb) {
		process.nextTick(function () {
			var cputime = usage.cpuTime();
			if (cputime!==undefined) 
			{
				this.cpuPerMinute = (cputime - this.lastTime) / 1000;
				this.lastTime = cputime;
			}

			cb&&cb(null,{ cpu: this.cpuPerMinute / 60000 * 100 * 100 });
		});
	};

	processUsage.prototype.lastTime=usage.cpuTime();

} else {
	var usage = require('usage');
	getUsage = usage.lookup;
}

processUsage.prototype.getUsage = getUsage;

module.exports=new processUsage;