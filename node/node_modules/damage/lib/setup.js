var _config = require('./config.js');
var _env = {};
var _prepare = function () {};
var _ = require('lodash');

function setup(config,env) {
	return setup.run(config,env);
};

setup.Damage = require('./damage.js');

/**
 * Changes the default configuration of Damage;
 */
setup.config = function (config) {
	if (!_.isObject(config))
		return false;
	_.merge(_config,config);
};

/**
 * Set new properties for the test enviroment
 */
setup.env = function (env) {
	if (!_.isObject(env))
		return false;
	_.merge(_env,env);
};

/**
 * Define a new test preparation
 */
setup.prepare = function (prepare) {
	if (!_.isFunction(prepare))
		return false;
	_prepare=prepare;
};

/**
 * Creates a new Damage.
 */
setup.run = function (config,env,prepare) {
	setup.config(config);
	setup.env(env);
	setup.prepare(prepare);
	return (new setup.Damage(_config,_env,_prepare)).exec;
};

module.exports = setup;